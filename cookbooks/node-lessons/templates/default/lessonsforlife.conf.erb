# lessonsforlife.conf
# Generated by Chef for <%= node['hostname'] %>.
# Local modifications will be overwritten.
# This script is to be placed in /etc/init to work with upstart.
#
# Internally the 'initctl' command is used to manage:
# initctl help
# initctl status lessonsforlife
# initctl reload lessonsforlife
# initctl start lessonsforlife

description "node.js server"
author      "Vincent Mac <vincent@avant.io>"
version     "1.0.1"

expect fork

start on started mountall
stop on shutdown

# Automatically Respawn
respawn
respawn limit 99 5

# Increase max open files (ulimit) from default @ 1024
limit nofile 32768 32768

env HOME=/root

script
  #set -e

  export HOME=$HOME

  # exec sudo -u www-data /usr/bin/node /var/www/lessonsforlifeproject.com/app.js 2>&1 >> /var/log/lessonsforlifeproject.com
  exec sudo -u <%= @user %> <%= @node_bin %> <%= @app %> 2>&1 >> <%= @log %>
end script