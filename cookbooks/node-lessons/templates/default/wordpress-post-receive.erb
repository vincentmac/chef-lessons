#!/bin/sh
# wordpress-post-receive.erb
# Generated by Chef for <%= node['hostname'] %>.
# Local modifications will be overwritten.
# This script is located in <%= node['node-lessons']['remote_hooks_api'] %>
# and run after pushing an update to this remote repository via `git push ec2 $branch`.
# http://blog.ekynoxe.com/2011/10/22/git-post-receive-for-multiple-remote-branches-and-work-trees/

GIT_WORK_TREE=<%= @app_dir %>
export GIT_WORK_TREE

while read oldrev newrev ref
do
  branch=`echo $ref | cut -d/ -f3`
  echo current branch: $branch
  sudo git --work-tree=$GIT_WORK_TREE checkout -f $branch
  sudo chown -R <%= @www_user %>:<%= @www_user %> <%= @app_dir %>
done